# Техническое задание на проект: "NHL Stats Tracker"

NHL Stats Tracker - Веб‑сервис статистики игроков НХЛ для болельщиков с целью аналитики сезонов по командам и метрикам

## Цель проекта
Создание веб‑сервиса, который позволяет болельщикам НХЛ анализировать статистику полевых игроков по сезонам, командам и ключевым метрикам (голы, передачи, очки, время на льду и т.д.).
Сервис помогает пользователю быстро находить нужных игроков, сравнивать их показатели и получать наглядную аналитику по выбранной команде и сезону.

## Роли пользователей
- **Гость, Зарегистрированный пользователь**: просмотр общего списка игроков и их статистики за выбранный сезон, фильтрация по командам и позициям, просмотр базовой аналитики (топ‑списки, лидеры по метрикам).
- **Администратор**: доступ к административной панели для управления пользователями, пересинхронизации данных, запуска ручного обновления статистики из внешнего API.

## Модели данных (сущности)

### Team (Команда)
| Поле         | Описание                                           |
|--------------|----------------------------------------------------|
| name         | Полное название команды (на английском)            |
| abbrev       | Краткое обозначение команды (3 буквы)              |
| conference   | Конференция (East/West)                            |
| division     | Дивизион (Metropolitan, Atlantic и т.д.)           |
| external_id  | Идентификатор команды во внешнем API (IntegerField)|
| full_name()  | Метод для получения локализованного названия (словарь FULL_NAMES) |

### Player (Игрок)
| Поле            | Описание                                          |
|-----------------|---------------------------------------------------|
| full_name       | Полное имя игрока                                 |
| last_name       | Фамилия игрока                                    |
| position        | Позиция (C, L, R, D) — CharField(1)               |
| shoots_catches  | Хват (L/R) — CharField(1)                         |
| external_id     | Идентификатор игрока во внешнем API (IntegerField, unique) |

### PlayerSeasonStat (Статистика игрока за сезон)
| Поле                 | Описание                                           |
|----------------------|----------------------------------------------------|
| player               | ForeignKey на Player (CASCADE)                     |
| season_id            | Код сезона (например, 20232024) — CharField(10)    |
| games_played         | Количество сыгранных матчей (IntegerField)         |
| goals                | Голы (IntegerField)                                |
| assists              | Передачи (IntegerField)                            |
| points               | Очки (IntegerField)                                |
| plus_minus           | Показатель плюс/минус (IntegerField, nullable)     |
| shots                | Количество бросков (IntegerField, nullable)        |
| shooting_pct         | Процент реализации бросков (FloatField, nullable)  |
| pp_goals             | Голы в большинстве (IntegerField, nullable)        |
| pp_points            | Очки в большинстве (IntegerField, nullable)        |
| sh_goals             | Голы в меньшинстве (IntegerField, nullable)        |
| sh_points            | Очки в меньшинстве (IntegerField, nullable)        |
| ev_goals             | Голы в равных составах (IntegerField, nullable)    |
| ev_points            | Очки в равных составах (IntegerField, nullable)    |
| time_on_ice_per_game | Среднее время на льду за матч (FloatField, nullable)|
| faceoff_win_pct      | Процент выигранных вбрасываний (FloatField, nullable)|
| teams                | Связь через промежуточную модель PlayerSeasonTeam (related_name='teams') |

### PlayerSeasonTeam (Связующая таблица)
| Поле                 | Описание                                           |
|----------------------|----------------------------------------------------|
| player_season_stat   | ForeignKey на PlayerSeasonStat (CASCADE, related_name='teams') |
| team                 | ForeignKey на Team (CASCADE)                       |

## Ключевой функционал (User Stories)

- **Просмотр общей статистики:** 
Пользователь выбирает сезон(например, 2023–2024), после чего сервис отображает таблицу с игроками и их ключевыми показателями (матчи, голы, передачи, очки, плюс/минус, время на льду).
Пользователь может сортировать таблицу по любой метрике (по команде, голам, очкам, времени на льду и т.д.) и быстро находить лидеров команды.

- **Фильтрация и поиск по игрокам:**  
Пользователь открывает страницу общего списка игроков сезона, задает фильтры: команда, позиция (например, только защитники), минимальное количество матчей и минимальное количество очков.
Система применяет фильтры к данным и выводит результирующий список игроков, позволяя сортировать его по различным статистическим полям и переходить на детальную страницу игрока.

- **Обновление статистики из внешнего API:**  
Администратор (или фоновый планировщик) запускает задачу обновления статистики.
Сервис отправляет запросы к внешнему NHL‑API, постранично загружает статистику игроков по выбранному сезону, обновляет или создает записи Player, Team и PlayerSeasonStat в базе данных, после чего пользователи видят свежие данные без ручного ввода:

## Изменения в ходе реализации

В процессе разработки функционал для зарегистрированных пользователей был упрощен для ускорения релиза и фокуса на core-функциях аналитики:
- **Убрана разница между гостями и зарегистрированными пользователями:**
теперь все пользователи (включая гостей) имеют доступ к просмотру списков, фильтрации и сортировке без авторизации.
- **Полностью удален функционал личных подборок**
сохранение «избранного» или именованных списков игроков, а также сохранение преднастроенных фильтров. Это упрощает backend (нет нужды в моделях User и связанных таблицах) и frontend (нет страниц профилей/кабинетов).
- **Роли пользователей скорректированы:**
гости и зарегистрированные — единая роль с базовым доступом; администратор остался без изменений.

Модели данных оптимизированы:
- **Убрана ManyToMany teams из Player**
игроки теперь привязаны к командам только через статистику сезонов
- **Добавлена промежуточная модель PlayerSeasonTeam**
для гибкой связи статистика и команды
- **external_id изменен на IntegerField**
с unique для Player
- **Добавлены null=True/blank=True для необязательных статистик**
shots, plus_minus и т.д.
- **В Team добавлен метод full_name()**
с словарем локализованных названий команд

Эти изменения не затрагивают ключевую аналитику (фильтры, сортировки, обновление данных из API) и позволяют запустить MVP быстрее.

## Внешние интеграции / Аналитика

- **Интеграции:**  
  Используется публичный NHL API:  
  `https://api.nhle.com/stats/rest/en/skater/summary`  
  Реализована постраничная загрузка (параметры `start` и `limit`).

- **Аналитика:**  
  Расчет производных метрик (очки за матч, очки за 60 минут, рейтинги).