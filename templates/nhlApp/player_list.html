{% extends "base.html" %}
{% block content %}
<h1>Игроки NHL</h1>

<form method="get" class="filters">
    <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-start;">
        <div style="min-width: 200px; text-align: center;">
            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151; font-size: 14px; line-height: 1.4;">
                Имя фамилия игрока:
            </label>
            {{ filter_form.name }}
        </div>

        <div style="min-width: 120px; text-align: center;">
            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151; font-size: 14px; line-height: 1.4;">
                Позиция:
            </label>
            {{ filter_form.position }}
        </div>

        <div style="min-width: 140px; text-align: center;">
            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151; font-size: 14px; line-height: 1.4;">
                Команда:
            </label>
            {{ filter_form.team }}
        </div>

        <div style="min-width: 140px; text-align: center;">
            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151; font-size: 14px; line-height: 1.4;">
                Сезон:
            </label>
            {{ filter_form.season_id }}
        </div>

        <div style="min-width: 250px; text-align: center;">
            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151; font-size: 14px; line-height: 1.4;">
                Минимальное количество очков:
            </label>
            {{ filter_form.min_points }}
        </div>

        <div style="display: flex; gap: 10px; justify-content: center; min-width: 200px; margin-top: 25px; padding-top: 10px;">
            <button type="submit">Фильтр</button>
            <a href="{% url 'nhlapp:player_list' %}" class="btn-reset">Сброс</a>
        </div>

    </div>
</form>

<div class="table-responsive">
    <table>
        <thead>
        <tr>
            <th>
                Игрок
                <span class="sort-arrows">
                    <a href="?{{ query_params }}&sort={% for f in current_sorts %}{{ f }},{% endfor %}name&order={% for o in current_orders %}{{ o }},{% endfor %}asc"
                       class="{% if current_sorts and current_sorts.0 == 'name' and current_orders.0 == 'asc' %}active{% endif %}">▲</a>
                    <a href="?{{ query_params }}&sort={% for f in current_sorts %}{{ f }},{% endfor %}name&order={% for o in current_orders %}{{ o }},{% endfor %}desc"
                       class="{% if current_sorts and current_sorts.0 == 'name' and current_orders.0 == 'desc' %}active{% endif %}">▼</a>
                </span>
            </th>
            <th>
                Позиция
                <span class="sort-arrows">
                    <a href="?{{ query_params }}&sort={% for f in current_sorts %}{{ f }},{% endfor %}position&order={% for o in current_orders %}{{ o }},{% endfor %}asc"
                       class="{% if current_sorts and current_sorts.0 == 'position' and current_orders.0 == 'asc' %}active{% endif %}">▲</a>
                    <a href="?{{ query_params }}&sort={% for f in current_sorts %}{{ f }},{% endfor %}position&order={% for o in current_orders %}{{ o }},{% endfor %}desc"
                       class="{% if current_sorts and current_sorts.0 == 'position' and current_orders.0 == 'desc' %}active{% endif %}">▼</a>
                </span>
            </th>
            <th>
                Команда
                <span class="sort-arrows">
                    <a href="?{{ query_params }}&sort={% for f in current_sorts %}{{ f }},{% endfor %}team&order={% for o in current_orders %}{{ o }},{% endfor %}asc"
                       class="{% if current_sorts and current_sorts.0 == 'team' and current_orders.0 == 'asc' %}active{% endif %}">▲</a>
                    <a href="?{{ query_params }}&sort={% for f in current_sorts %}{{ f }},{% endfor %}team&order={% for o in current_orders %}{{ o }},{% endfor %}desc"
                       class="{% if current_sorts and current_sorts.0 == 'team' and current_orders.0 == 'desc' %}active{% endif %}">▼</a>
                </span>
            </th>
            <th>
                Игр
                <span class="sort-arrows">
                    <a href="?{{ query_params }}&sort={% for f in current_sorts %}{{ f }},{% endfor %}games&order={% for o in current_orders %}{{ o }},{% endfor %}asc"
                       class="{% if current_sorts and current_sorts.0 == 'games' and current_orders.0 == 'asc' %}active{% endif %}">▲</a>
                    <a href="?{{ query_params }}&sort={% for f in current_sorts %}{{ f }},{% endfor %}games&order={% for o in current_orders %}{{ o }},{% endfor %}desc"
                       class="{% if current_sorts and current_sorts.0 == 'games' and current_orders.0 == 'desc' %}active{% endif %}">▼</a>
                </span>
            </th>
            <th>
                Голы
                <span class="sort-arrows">
                    <a href="?{{ query_params }}&sort={% for f in current_sorts %}{{ f }},{% endfor %}goals&order={% for o in current_orders %}{{ o }},{% endfor %}asc"
                       class="{% if current_sorts and current_sorts.0 == 'goals' and current_orders.0 == 'asc' %}active{% endif %}">▲</a>
                    <a href="?{{ query_params }}&sort={% for f in current_sorts %}{{ f }},{% endfor %}goals&order={% for o in current_orders %}{{ o }},{% endfor %}desc"
                       class="{% if current_sorts and current_sorts.0 == 'goals' and current_orders.0 == 'desc' %}active{% endif %}">▼</a>
                </span>
            </th>
            <th>
                Передачи
                <span class="sort-arrows">
                    <a href="?{{ query_params }}&sort={% for f in current_sorts %}{{ f }},{% endfor %}assists&order={% for o in current_orders %}{{ o }},{% endfor %}asc"
                       class="{% if current_sorts and current_sorts.0 == 'assists' and current_orders.0 == 'asc' %}active{% endif %}">▲</a>
                    <a href="?{{ query_params }}&sort={% for f in current_sorts %}{{ f }},{% endfor %}assists&order={% for o in current_orders %}{{ o }},{% endfor %}desc"
                       class="{% if current_sorts and current_sorts.0 == 'assists' and current_orders.0 == 'desc' %}active{% endif %}">▼</a>
                </span>
            </th>
            <th>
                Очки
                <span class="sort-arrows">
                    <a href="?{{ query_params }}&sort={% for f in current_sorts %}{{ f }},{% endfor %}points&order={% for o in current_orders %}{{ o }},{% endfor %}asc"
                       class="{% if current_sorts and current_sorts.0 == 'points' and current_orders.0 == 'asc' %}active{% endif %}">▲</a>
                    <a href="?{{ query_params }}&sort={% for f in current_sorts %}{{ f }},{% endfor %}points&order={% for o in current_orders %}{{ o }},{% endfor %}desc"
                       class="{% if current_sorts and current_sorts.0 == 'points' and current_orders.0 == 'desc' %}active{% endif %}">▼</a>
                </span>
            </th>
        </tr>
        </thead>
        <tbody>
            {% for player in players %}
            <tr>
                <td>
                    <a href="{% url 'nhlapp:player_detail' player.pk %}">
                        {{ player.full_name }}
                    </a>
                    <br><small style="color: #666;">{{ player.position }}</small>
                </td>
                <td>{{ player.position }}</td>
                <td>
                    {% for team in player.teams.all|slice:":2" %}
                        <strong>{{ team.abbrev }}</strong>{% if not forloop.last %}, {% endif %}
                    {% empty %}
                        -
                    {% endfor %}
                </td>
                {% if player.season_stats %}
                    {% with player.season_stats.0 as stats %}
                        <td>{{ stats.games_played|default:0 }}</td>
                        <td>{{ stats.goals|default:0 }}</td>
                        <td>{{ stats.assists|default:0 }}</td>
                        <td class="stats-highlight">{{ stats.points|default:0 }}</td>
                    {% endwith %}
                {% else %}
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td class="stats-highlight">0</td>
                {% endif %}
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" style="padding: 40px; text-align: center; color: #999;">
                    Игроки не найдены
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if is_paginated %}
<div class="pagination">
    Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}

    {% if page_obj.has_previous %}
        <a href="?{{ query_params }}&page={{ page_obj.previous_page_number }}"
           style="margin: 0 10px; padding: 8px 16px; background: #007bff; color: white; text-decoration: none; border-radius: 4px;">
            ← Пред
        </a>
    {% endif %}

    {% if page_obj.has_next %}
        <a href="?{{ query_params }}&page={{ page_obj.next_page_number }}"
           style="margin: 0 10px; padding: 8px 16px; background: #007bff; color: white; text-decoration: none; border-radius: 4px;">
            След →
        </a>
    {% endif %}
</div>
{% endif %}
{% endblock %}
